import pandas as pd
from sklearn.feature_selection import SelectFromModel
from sklearn.ensemble import ExtraTreesClassifier


def malware_data_read():

    # データの読み込み
    malware_dataset = pd.read_csv('MalwareData.csv', sep='|')

    # データセットから名前、MD5ハッシュ値、ラベルといった列を除外してx_objに代入
    x_obj = malware_dataset.drop(['Name', 'md5', 'legitimate'], axis='columns')

    # データセットのレベル列のみを抽出してyに代入
    y_obj = malware_dataset['legitimate']

    # ExtraTreesClassifierを使用
    fast_select = ExtraTreesClassifier().fit(x_obj, y_obj)

    # SelectFromModelを使用して
    # ExtraTreesClassifierによる分類結果に寄与した重要度の大きい特徴量のみを抽出
    model_obj = SelectFromModel(fast_select, prefit=True)

    # 重要度の大きい特徴量のカラム名を取得
    feature_idx = model_obj.get_support()
    feature_name = x_obj.columns[feature_idx]

    # Xに選択した特徴量のみを代入し直す
    x_obj_2 = model_obj.transform(x_obj)

    # 重要度の大きい特徴量のカラム名を設定
    x_obj_2 = pd.DataFrame(x_obj_2)
    x_obj_2.columns = feature_name

    return x_obj_2, y_obj, malware_dataset
